<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-person-circle me-2"></i>Sign In
  </h5>
  <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
</div>
<div class="modal-body">
  @if (isLoading) {
    <div class="d-flex justify-content-center align-items-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }
  
  <form [formGroup]="form" (ngSubmit)="login()">
    <div class="mb-3">
      <label for="username" class="form-label fw-semibold">
        <i class="bi bi-person me-1"></i>Username
      </label>
      <input 
        id="username" 
        type="text" 
        class="form-control form-control-lg" 
        formControlName="username"
        placeholder="Enter your username"
        [class.is-invalid]="form.get('username')?.touched && form.get('username')?.invalid"
        [disabled]="isLoading"
        autocomplete="username">
      @if (form.get('username')?.touched && form.get('username')?.invalid) {
        <div class="invalid-feedback">
          <i class="bi bi-exclamation-circle me-1"></i>Username is required
        </div>
      }
    </div>
    
    <div class="mb-3">
      <label for="password" class="form-label fw-semibold">
        <i class="bi bi-lock me-1"></i>Password
      </label>
      <div class="position-relative">
        <input 
          id="password" 
          [type]="showPassword ? 'text' : 'password'" 
          class="form-control form-control-lg" 
          formControlName="password"
          placeholder="Enter your password"
          [class.is-invalid]="form.get('password')?.touched && form.get('password')?.invalid"
          [disabled]="isLoading"
          autocomplete="current-password">
        <button 
          type="button" 
          class="btn btn-link position-absolute end-0 top-50 translate-middle-y text-muted password-toggle"
          (click)="togglePasswordVisibility()"
          [disabled]="isLoading"
          tabindex="-1">
          <i class="bi" [class.bi-eye]="!showPassword" [class.bi-eye-slash]="showPassword"></i>
        </button>
      </div>
      @if (form.get('password')?.touched && form.get('password')?.invalid) {
        <div class="invalid-feedback d-block">
          <i class="bi bi-exclamation-circle me-1"></i>Password is required
        </div>
      }
    </div>

    <div class="mb-3 form-check">
      <input
        type="checkbox"
        class="form-check-input"
        id="remember_me"
        formControlName="remember_me"
        [disabled]="isLoading">
      <label class="form-check-label" for="remember_me">
        @if (rememberMeDays > 0) {
          Remember me ({{rememberMeDays}} days)
        } @else {
          Remember me (extended session)
        }
      </label>
    </div>

    @if (loginError) {
      <div class="alert alert-danger d-flex align-items-center" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <div>{{loginError}}</div>
      </div>
    }

    <button 
      type="submit" 
      class="btn btn-primary btn-lg w-100 mb-3"
      [disabled]="!form.valid || isLoading">
      @if (isLoading) {
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Signing in...
      } @else {
        <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
      }
    </button>
  </form>

  @if (allowOrcid) {
    <div class="divider my-4">
      <span class="divider-text">OR</span>
    </div>
    
    <div class="text-center">
      <a 
        (click)="clickOrcid()" 
        type="button" 
        target="_blank" 
        class="btn btn-outline-success btn-lg w-100 orcid-button" 
        id="orcidAuthButton" 
        href="https://orcid.org/oauth/authorize?response_type=code&amp;redirect_uri=https://curtain.proteo.info/&amp;client_id={{orcid}}&amp;scope=openid"
        [class.disabled]="isLoading">
        <svg class="orcid-icon me-2" width="20" height="20" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
          <path fill="#A6CE39" d="M256 128c0 70.7-57.3 128-128 128S0 198.7 0 128S57.3 0 128 0s128 57.3 128 128z"/>
          <path fill="#FFF" d="M86.3 186.2H70.9V79.1h15.4v107.1zM108.9 79.1h41.6c39.6 0 57 28.3 57 53.6c0 27.5-21.5 53.6-56.8 53.6h-41.8V79.1zm15.4 93.3h24.5c34.9 0 42.9-26.5 42.9-39.7c0-21.5-13.7-39.7-43.7-39.7h-23.7v79.4z"/>
          <path fill="#FFF" d="M88.7 56.8c0 5.5-4.5 10.1-10.1 10.1s-10.1-4.6-10.1-10.1c0-5.6 4.5-10.1 10.1-10.1s10.1 4.6 10.1 10.1z"/>
        </svg>
        Continue with ORCID iD
      </a>
      <p class="text-muted small mt-2 mb-0">
        <i class="bi bi-info-circle me-1"></i>Connect using your ORCID account
      </p>
    </div>
  }
</div>

