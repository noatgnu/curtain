<div class="modal-header">
  <h5>Account Information</h5>
</div>
<div class="modal-body">
  <div class="card mb-2">
    <div class="card-body py-2">
      <div class="row g-2">
        <div class="col-md-4">
          <small class="text-muted">Username:</small><br>
          <strong>{{accounts.curtainAPI.user.username}}</strong>
        </div>
        <div class="col-md-4">
          <small class="text-muted">Link Limits:</small><br>
          @if (accounts.curtainAPI.user.curtainLinkLimit === 0) {<strong>infinite</strong>}@if (accounts.curtainAPI.user.curtainLinkLimit > 0) {<strong>{{accounts.curtainAPI.user.curtainLinkLimit}}</strong>} @if (accounts.curtainAPI.user.curtainLinkLimitExceeded) {<span class="text-danger">- Limit Exceed</span>}
        </div>
        <div class="col-md-4">
          <small class="text-muted">Total Sessions:</small><br>
          <strong>{{accounts.curtainAPI.user.totalCurtain}}</strong>
        </div>
      </div>
    </div>
  </div>
  <form [formGroup]="form" (submit)="submit()">
    <div class="row g-2 mb-2">
      <div class="col-md-9">
        <label for="session-search" class="form-label small">Search Session Description:</label>
        <input type="text" formControlName="sessionDescription" id="session-search" class="form-control form-control-sm">
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary btn-sm w-100" type="submit">Search</button>
      </div>
    </div>
  </form>
  @if (totalItems > 0) {
    <div class="d-flex justify-content-between align-items-center mb-2">
      <small class="text-muted">{{selectedCount}} Selected</small>
      <ngb-pagination [collectionSize]="totalItems" [(page)]="currentPage" [maxSize]="5" [boundaryLinks]="true" [size]="'sm'" (pageChange)="submit($event)"></ngb-pagination>
    </div>
    <table class="table table-striped table-sm">
      <thead>
      <tr>
        <th scope="col">

        </th>
        <th scope="col">
          Link
        </th>
        <th scope="col">
          Description
        </th>
        <th scope="col">
          Public or Private
        </th>
        <th scope="col">
          <div ngbDropdown class="d-inline-block">
            <button class="btn btn-outline-primary btn-sm" id="accountSelectedLinksAction" ngbDropdownToggle>Actions</button>
            <div ngbDropdownMenu>
              <div class="px-3 py-2">
                <div class="mb-2">
                  <label for="addMultipleOwner" class="form-label small">Add Owner:</label>
                  <input type="text" placeholder="Username" id="addMultipleOwner" class="form-control form-control-sm" #allowner>
                  <button class="btn btn-sm btn-primary mt-1 w-100" (click)="addOwnerToSelectedLinks(allowner.value)">Submit</button>
                </div>
              </div>
              <button ngbDropdownItem (click)="removeSelectedLinks()">Remove Selected</button>
              <button ngbDropdownItem (click)="changePublicitySelectedLinks(true)">Set Selected Public</button>
              <button ngbDropdownItem (click)="changePublicitySelectedLinks(false)">Set Selected Private</button>
            </div>
          </div>

        </th>
      </tr>

      </thead>
      <tbody>
      @for (d of data.results; track d) {
        <tr>
          <td>
            <input type="checkbox" class="form-check-input" [(ngModel)]="selectedLinks[d.link_id]" (click)="addOrRemoveFromSelected(d.link_id)">
          </td>
          <td>
            <a href="{{base}}/#/{{d.link_id}}" target="_blank">{{d.link_id}}</a>
          </td>
          <td>
<!--            {{d.created}}-->
            <div [innerHTML]="d.description"></div>
          </td>
          <td>
            @if (d.enable) {<span class="badge bg-success">Public</span>}
            @if (!d.enable) {<span class="badge bg-secondary">Private</span>}
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <button class="btn btn-outline-primary btn-sm" (click)="viewDescription(d.link_id)">Details</button>
              @if (accounts.curtainAPI.user.canDelete) {<button class="btn btn-outline-danger btn-sm" (click)="deleteLink(d.link_id)">Rm</button>}
            </div>
          </td>
        </tr>
        @if (descriptionTrigger[d.link_id]) {
        <tr class="table-light">
          <td [colSpan]="5">
            <div class="p-2">
              <small class="text-muted">Owners:</small>
              <div class="mt-1">
                @for (o of d['owners']; track o) {
                <span class="badge bg-info me-1">{{o.username}}</span>
                }
              </div>
            </div>
          </td>
        </tr>
        }
      }

      </tbody>
    </table>
  }

</div>
