<div class="modal-header">
  <h5 class="modal-title">
    <i class="bi bi-palette me-2"></i>Color Palette Customization
  </h5>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>
<div class="modal-body">
  <div class="alert alert-info" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    <strong>How it works:</strong> These colors are applied to plot components in order and cycle back to the beginning when all colors are used.
  </div>
  <div class="row g-3">
    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-palette-fill me-2"></i>Current Palette</h6>
        </div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2 mb-3">
            @for (c of currentColor; track c; let i = $index) {
              <div class="color-swatch-container">
                <div class="color-swatch" [style.background-color]="c" [title]="c"></div>
                <small class="text-muted">{{i + 1}}</small>
              </div>
            }
          </div>
          <button class="btn btn-outline-primary btn-sm w-100" (click)="openCustomPalette('current')">
            <i class="bi bi-pencil me-1"></i>Customize Current
          </button>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card h-100">
        <div class="card-header">
          <h6 class="mb-0"><i class="bi bi-collection me-2"></i>Built-in Palettes</h6>
        </div>
        <div class="card-body">
          <form [formGroup]="form">
            <div class="mb-3">
              <label for="colorPalette" class="form-label small">Select a palette</label>
              <select id="colorPalette" class="form-select form-select-sm" formControlName="colorPalette">
                <option [value]="''">-- Choose a palette --</option>
                @for (o of colorPaletteList; track o) {
                  <option [value]="o">{{o}}</option>
                }
              </select>
            </div>
          </form>
          @if (selectedColor.length > 0) {
            <div class="d-flex flex-wrap gap-2 mb-3">
              @for (c of selectedColor; track c; let i = $index) {
                <div class="color-swatch-container">
                  <div class="color-swatch" [style.background-color]="c" [title]="c"></div>
                  <small class="text-muted">{{i + 1}}</small>
                </div>
              }
            </div>
            <button class="btn btn-outline-primary btn-sm w-100" (click)="openCustomPalette(form.value['colorPalette'])">
              <i class="bi bi-pencil me-1"></i>Customize Selected
            </button>
          }
        </div>
      </div>
    </div>

    @if (customPalette.length > 0) {
      <div class="col-md-4">
        <div class="card h-100 border-primary">
          <div class="card-header bg-primary bg-opacity-10">
            <h6 class="mb-0"><i class="bi bi-brush me-2"></i>Custom Palette</h6>
          </div>
          <div class="card-body">
            <div class="mb-3">
              @for (c of customPalette; track c; let ind = $index) {
                <div class="d-flex align-items-center mb-2">
                  <small class="text-muted me-2" style="width: 20px;">{{ind + 1}}</small>
                  <input class="form-control form-control-sm color-input"
                         [(colorPicker)]="customPalette[ind].new"
                         [style.background]="customPalette[ind].new"
                         [style.color]="getContrastColor(customPalette[ind].new)"
                         [value]="customPalette[ind].new"
                         id="color-settings-for-{{ind}}">
                  <button class="btn btn-outline-danger btn-sm ms-2" (click)="removeCustomColor(ind)" title="Remove color">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              }
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-success btn-sm" (click)="addCustomColor()">
                <i class="bi bi-plus-circle me-1"></i>Add Color
              </button>
              <button class="btn btn-outline-secondary btn-sm" (click)="clearCustomPalette()">
                <i class="bi bi-x-circle me-1"></i>Clear Palette
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  </div>

  <div class="card mt-3">
    <div class="card-header">
      <h6 class="mb-0"><i class="bi bi-code-square me-2"></i>Import/Export</h6>
    </div>
    <div class="card-body">
      <label for="paletteConfig" class="form-label small">Paste palette JSON to import</label>
      <textarea
        id="paletteConfig"
        class="form-control form-control-sm font-monospace mb-2"
        rows="3"
        placeholder='["#FF0000", "#00FF00", "#0000FF"]'
        #config></textarea>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm" (click)="parseConfig(config.value)">
          <i class="bi bi-upload me-1"></i>Import Palette
        </button>
        <button class="btn btn-outline-secondary btn-sm" (click)="copyColorListToClipboard()">
          <i class="bi bi-clipboard me-1"></i>Copy Current
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-footer d-flex justify-content-between align-items-center">
  <form [formGroup]="form">
    <div class="d-flex gap-3">
      <div class="form-check">
        <input type="checkbox" id="resetVolcanoColor" class="form-check-input" formControlName="resetVolcanoColor">
        <label class="form-check-label small" for="resetVolcanoColor">
          <i class="bi bi-arrow-clockwise me-1"></i>Reset Volcano Colors
        </label>
      </div>
      <div class="form-check">
        <input type="checkbox" id="resetBarChartColor" class="form-check-input" formControlName="resetBarChartColor">
        <label class="form-check-label small" for="resetBarChartColor">
          <i class="bi bi-arrow-clockwise me-1"></i>Reset Bar Chart Colors
        </label>
      </div>
    </div>
  </form>
  <div class="d-flex gap-2">
    <button class="btn btn-secondary" (click)="close()" type="button">
      <i class="bi bi-x-lg me-1"></i>Cancel
    </button>
    <button class="btn btn-primary" (click)="updateColor()">
      <i class="bi bi-check-lg me-1"></i>Apply Changes
    </button>
  </div>
</div>
