<div class="modal-header">
  <h5 class="modal-title">
    Sample and condition assignment
  </h5>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>
<div class="modal-body">
  <div class="card mb-3">
    <div class="card-body">
      <h6 class="card-title">Bulk Assignment</h6>
      <div class="d-flex gap-2 align-items-center">
        <button type="button" class="btn btn-sm btn-outline-primary" (click)="selectAll()">
          Select All
        </button>
        <button type="button" class="btn btn-sm btn-outline-secondary" (click)="deselectAll()">
          Deselect All
        </button>
        <div class="vr"></div>
        <label for="bulkConditionInput" class="visually-hidden">Bulk condition name</label>
        <input
          type="text"
          id="bulkConditionInput"
          class="form-control form-control-sm"
          [(ngModel)]="bulkConditionName"
          placeholder="Condition name..."
          style="max-width: 200px">
        <button
          type="button"
          class="btn btn-sm btn-primary"
          (click)="applyBulkCondition()"
          [disabled]="selectedSamples.size === 0 || bulkConditionName.trim() === ''">
          <i class="bi bi-arrow-right me-1"></i>Apply to Selected ({{selectedSamples.size}})
        </button>
      </div>
    </div>
  </div>

  <table class="table table-striped table-hover">
    <thead>
    <tr>
      <th scope="col" style="width: 40px">
        <input
          type="checkbox"
          class="form-check-input"
          [checked]="selectedSamples.size === samples.length && samples.length > 0"
          (change)="selectedSamples.size === samples.length ? deselectAll() : selectAll()"
          aria-label="Select all samples">
      </th>
      <th scope="col">Sample</th>
      <th scope="col">Condition</th>
      <th scope="col" style="width: 100px">Actions</th>
    </tr>
    </thead>
    <tbody>
    @for (s of samples; track s; let i = $index) {
    <tr [class.table-primary]="selectedSamples.has(s)">
      <td>
        <input
          type="checkbox"
          class="form-check-input"
          [checked]="selectedSamples.has(s)"
          (change)="toggleSampleSelection(s)"
          [attr.aria-label]="'Select sample ' + s">
      </td>
      <td><b>{{s}}</b></td>
      <td>
        <label [for]="'condition-' + i" class="visually-hidden">Condition for {{s}}</label>
        <input
          type="text"
          [id]="'condition-' + i"
          [(ngModel)]="sampleMap[s].condition"
          class="form-control form-control-sm">
      </td>
      <td>
        <button
          type="button"
          class="btn btn-sm btn-outline-secondary"
          (click)="copyFromAbove(i)"
          [disabled]="i === 0"
          [attr.aria-label]="'Copy condition from above to ' + s">
          <i class="bi bi-arrow-down" aria-hidden="true"></i>
        </button>
      </td>
    </tr>
    }
    </tbody>
  </table>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="close()">
        Close
    </button>
    <button type="button" class="btn btn-primary" id="saveSampleCondition" (click)="save()">
        Save
    </button>
</div>
