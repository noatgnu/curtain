@if (preview) {
  <div class="state-preview p-2 border rounded bg-light">
    <div class="d-flex justify-content-between align-items-start mb-2">
      <div>
        <h6 class="mb-1">{{preview.metadata.name}}</h6>
        @if (preview.metadata.currentID) {
          <small class="text-muted">Session: {{preview.metadata.currentID}}</small>
        }
      </div>
      @if (preview.metadata.isAutoSave) {
        <span class="badge bg-warning text-dark">Auto-save</span>
      }
    </div>

    @if (preview.metadata.description) {
      <p class="small text-muted mb-2">{{preview.metadata.description}}</p>
    }

    <div class="mb-2">
      <small class="text-muted">
        <i class="bi bi-calendar3 me-1"></i>{{formatDate(preview.metadata.date)}}
      </small>
    </div>

    @if (preview.metadata.tags && preview.metadata.tags.length > 0) {
      <div class="mb-2">
        @for (tag of preview.metadata.tags; track tag) {
          <span class="badge bg-secondary me-1">{{tag}}</span>
        }
      </div>
    }

    <div class="small">
      <div class="fw-semibold mb-1">Contents:</div>
      <ul class="list-unstyled mb-0 ps-2">
        @for (cs of getCategoriesWithData(); track cs.category.key) {
          <li class="d-flex align-items-center">
            <i class="bi bi-check-circle-fill text-success me-1" style="font-size: 0.7rem;"></i>
            <span>{{cs.category.label}}</span>
            @if (cs.itemCount > 0) {
              <span class="text-muted ms-1">({{cs.itemCount}})</span>
            }
          </li>
        }
      </ul>
    </div>

    <div class="mt-2 pt-2 border-top small text-muted">
      <span><i class="bi bi-gear me-1"></i>{{preview.totalSettingsCount}} settings</span>
      <span class="ms-2"><i class="bi bi-check2-square me-1"></i>{{preview.selectionsCount}} selections</span>
    </div>
  </div>
} @else {
  <div class="text-center text-muted p-3">
    <i class="bi bi-info-circle"></i> No preview available
  </div>
}
